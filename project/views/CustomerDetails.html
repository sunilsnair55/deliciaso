<!DOCTYPE html>
<html lang="en" ng-app="myApp"ng-controller="myCtrl" ng-init="init()">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Deliciaso | </title>

  <!-- Bootstrap core CSS -->

  <link href="css/bootstrap.min.css" rel="stylesheet">

  <link href="fonts/css/font-awesome.min.css" rel="stylesheet">
  <link href="css/animate.min.css" rel="stylesheet">

  <!-- Custom styling plus plugins -->
  <link rel="stylesheet" href="angular/angular-material.css">
  <link href="css/custom.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/maps/jquery-jvectormap-2.0.3.css" />
  <link href="css/icheck/flat/green.css" rel="stylesheet" />
  <link href="css/floatexamples.css" rel="stylesheet" type="text/css" />
    <link href="css/tag.css" rel="stylesheet" type="text/css" />

  <link rel="stylesheet" type="text/css" href="angular-ui-grid/ui-grid.min.css"></script>


<script src="js/jquery.min.js"></script>
<script src="angular/angular.min.js"></script>
<script src="angular/angular-animate.js"></script>
<script src="angular/angular-aria.js"></script>
<script src="angular/angular-material.js"></script>
<script src="angular-ui-grid/ui-grid.min.js"></script>







  <script src="js/nprogress.js"></script>
  <script src="js/validator/validator.js"></script>
<style>
.grid {
  width: 1000px;
  height: 250px;
}
</style>

</head>


<body class="nav-md">

  <div class="container body">


    <div class="main_container">

      <div class="col-md-3 left_col">
        <div class="left_col scroll-view">

          <div class="navbar nav_title" style="border: 0;">
            <a href="/order" class="site_title" style="height:106px;padding-left:0px;"><img src="images/deliciaso_logo.png" class="img-circle profile_img" style="height:86px;width:134px;"></a>
          </div>
          <div class="clearfix"></div>

          <!-- menu prile quick info -->
          <div class="profile" style="margin-top:50px;">
            <div class="profile_pic">
              <img src="images/avatar.ico" alt="..." class="img-circle profile_img">
            </div>
            <div class="profile_info">
              <span>Welcome,</span>
              <h2>Admin</h2>
            </div>
          </div>
          <!-- /menu prile quick info -->

          <br />

          <!-- sidebar menu -->
          <div id="sidebar-menu" class="main_menu_side hidden-print main_menu" >

            <div class="menu_section">
              <h3>&nbsp;</h3>
              <ul class="nav side-menu">
                <li><a><i class="fa fa-home"></i> Home <span class="fa fa-chevron-down"></span></a>
                  <ul class="nav child_menu" style="display: none">
                    <li><a href="/order">New Order</a>
                    </li>
                    <li><a href="/payment">Payments</a>
                    </li>
                    <li><a href="/customers">Customers</a>
                    </li>
                  </ul>
                </li>

              </ul>
            </div>
          </div>
          <!-- /sidebar menu -->

          <!-- /menu footer buttons -->
          <div class="sidebar-footer hidden-small">
            <a data-toggle="tooltip" data-placement="top" title="Settings">
              <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
            </a>
            <a data-toggle="tooltip" data-placement="top" title="FullScreen">
              <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
            </a>
            <a data-toggle="tooltip" data-placement="top" title="Lock">
              <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
            </a>
            <a data-toggle="tooltip" data-placement="top" title="Logout">
              <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
            </a>
          </div>
          <!-- /menu footer buttons -->
        </div>
      </div>

      <!-- top navigation -->
      <div class="top_nav">

        <div class="nav_menu">
          <nav class="" role="navigation">
            <div class="nav toggle">
              <a id="menu_toggle"><i class="fa fa-bars"></i></a>
            </div>

            <ul class="nav navbar-nav navbar-right">
              <li class="">
                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                  <img src="images/avatar.ico" alt="">Admin
                  <span class=" fa fa-angle-down"></span>
                </a>
                <ul class="dropdown-menu dropdown-usermenu animated fadeInDown pull-right">
                  <li><a href="javascript:;">  Profile</a>
                  </li>
                  <li><a href="/"><i class="fa fa-sign-out pull-right"></i> Log Out</a>
                  </li>
                </ul>
              </li>
            </ul>
          </nav>
        </div>

      </div>
      <!-- /top navigation -->


      <!-- page content -->
      <div class="right_col" role="main" style="height:900px !important;">

        <!-- top tiles -->
        <div class="row tile_count">
          <div class="animated flipInY col-md-2 col-sm-4 col-xs-4 tile_stats_count">
            <div class="left"></div>
            <div class="right">
              <span class="count_top"><i class="fa fa-user"></i> Total Customers</span>
              <div class="count">0</div>
            </div>
          </div>
          <div class="animated flipInY col-md-2 col-sm-4 col-xs-4 tile_stats_count">
            <div class="left"></div>
            <div class="right">
              <span class="count_top"><i class="fa fa-clock-o"></i>Total Cakes Sold</span>
              <div class="count">0</div>
            </div>
          </div>
          <div class="animated flipInY col-md-2 col-sm-4 col-xs-4 tile_stats_count">
            <div class="left"></div>
            <div class="right">
              <span class="count_top"><i class="fa fa-user"></i> Completed Payments</span>
              <div class="count green">0</div>
            </div>
          </div>
          <div class="animated flipInY col-md-2 col-sm-4 col-xs-4 tile_stats_count">
            <div class="left"></div>
            <div class="right">
              <span class="count_top"><i class="fa fa-user"></i> Due Payments</span>
              <div class="count">0</div>
            </div>
          </div>
          <div class="animated flipInY col-md-2 col-sm-4 col-xs-4 tile_stats_count">
            <div class="left"></div>
            <div class="right">
              <span class="count_top"><i class="fa fa-user"></i> Total Collections</span>
              <div class="count">0</div>
            </div>
          </div>
          <div class="animated flipInY col-md-2 col-sm-4 col-xs-4 tile_stats_count">
            <div class="left"></div>
            <div class="right">
              <span class="count_top"><i class="fa fa-user"></i> Today`s Collection</span>
              <div class="count">0</div>
            </div>
          </div>

        </div>
        <!-- /top tiles -->
        <br /><br />

        <div class="col-md-12 col-sm-12 col-xs-12">


  <div class="alert alert-success"  id="SmsSuccess" style="display:none;text-align:center;">
  <strong id="SmsSuccessMessage"></strong>
  </div>
  <div class="alert alert-danger"  id="SmsError" style="display:none;text-align:center;">
  <strong id="SmsErrorMessage"></strong>
  </div>


          <div class="x_panel">
            <div class="x_title">
              <h2><i class="fa fa-bars"></i>Customer Details</h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">

            <button type="button" class="btn btn-success" ng-click="SendBulkSmsModal()">Send Bulk SMS</button>

            <div ui-grid="gridOptions" ui-grid-pagination ui-grid-selection class="grid"  ></div>

            </div>
          </div>
        </div>




      </div>
      <!-- /page content -->

    </div>

  </div>

  <div id="custom_notifications" class="custom-notifications dsp_none">
    <ul class="list-unstyled notifications clearfix" data-tabbed_notifications="notif-group">
    </ul>
    <div class="clearfix"></div>
    <div id="notif-group" class="tabbed_notifications"></div>
  </div>

  <script src="js/bootstrap.min.js"></script>
  <script src="js/nicescroll/jquery.nicescroll.min.js"></script>
  <script src="js/custom.js"></script>
    <script type="text/javascript" src="js/wizard/jquery.smartWizard.js"></script>


  <!-- pace -->
  <script src="js/pace/pace.min.js"></script>

  <script>

  var app = angular.module('myApp', ['ui.grid','ui.grid.pinning','ui.grid.pagination','ui.grid.resizeColumns','ui.grid.selection']);

  // app.controller('myCtrl', function($scope,$http,$timeout, $q, $log,uiGridConstants) {
app.controller('myCtrl', ['$scope', '$http', '$log', '$timeout', 'uiGridConstants', function ($scope, $http, $log, $timeout, $uiGridConstants) {

    $scope.GetCustomerData = function(){

        $http.get('/GetCustomerData/api').success(function(response){
          $scope.AllCustomerData = response
        });

    };
    $scope.GetCustomerData();

      $scope.gridOptions = {
          data: 'AllCustomerData',
          paginationPageSizes: [25, 50, 75],
          paginationPageSize: 25,
          useExternalPagination: true,
          enableColumnResizing: true,
          enableFiltering: true,

           enableRowSelection: true,
           enableSelectAll: true,
           selectionRowHeaderWidth: 35,
           rowHeight: 35,
           showGridFooter:true,

          columnDefs: [{field:'Name', displayName:'Name',width:100},
      {field:'Mobile', displayName:'Mobile',width:100},
      {field:'Email', displayName:'Email',width:100},
      {field:'Gender', displayName:'Gender',width:100},
      {field:'Address', displayName:'Address',width:300},
      {field:'Zip', displayName:'Zip',width:100},
      {field:'Id', cellTemplate: '<button class="btn btn-primary" ng-click="grid.appScope.SendSms(row)">Send SMS</button>',displayName:'Send SMS',width:120,enableFiltering: false,enableCellEdit:false}
    ]
    };
$scope.gridOptions.onRegisterApi = function(gridApi){
//set gridApi on scope
$scope.gridApi = gridApi;
};

$scope.SendSms = function(row){
$scope.AllCustData = "";
$scope.Individual = "";
$scope.AllCustData = row.entity;
console.log($scope.AllCustData);
$('#SendSMSModal').modal('show');
};

$scope.SendBulkSmsModal = function()
{
  $scope.mySelectedRows = "";
  $scope.Bulk = "";
  $scope.mySelectedRows = $scope.gridApi.selection.getSelectedRows();
  console.log($scope.mySelectedRows);
  if($scope.mySelectedRows!="")
  {
    $('#SendBulkSmsModal').modal('show');
  }
  else {
    $('#SmsError').show(1000).delay(2000).hide(1000);;
    $('#SmsErrorMessage').html("Select minimum one customer");
  }
};

$scope.SendIndividualSms = function(){

      if($scope.Individual.SMSContent!=undefined)
      {
        if($scope.Individual.SMSContent!="")
        {
                var FinalIndividualSMSData = {"To":$scope.AllCustData.Mobile,"Message":$scope.Individual.SMSContent};

                $http.post('SendIndividualSMS',FinalIndividualSMSData).success(function(response){
                if(response)
                {
                $('#SendSMSModal').modal('hide');
                $('#SmsSuccess').show(1000).delay(2000).hide(1000);;
                $('#SmsSuccessMessage').html(response.message);

                }
                else
                {
                $('#SmsError').show(1000).delay(2000).hide(1000);;
                $('#SmsErrorMessage').html("Not possible to execute now! Sorry for the inconvenience.");
                }

                });
        }
        else {
          $('#SmsIndividualError').show(1000).delay(2000).hide(1000);;
          $('#SmsIndividualErrorMessage').html("Message should not be empty");
        }
      }
      else {
        $('#SmsIndividualError').show(1000).delay(2000).hide(1000);;
        $('#SmsIndividualErrorMessage').html("Message should not be empty.");
      }
};

var FullMobile =[];
$scope.SendBulkSms = function(){

  if($scope.Bulk.SMSContent!=undefined)
  {
    if($scope.Bulk.SMSContent!="")
    {

            for (var i=0;i<$scope.mySelectedRows.length;i++)
            {
            FullMobile.push($scope.mySelectedRows[i].Mobile);
            }
            var CommaSeperatedMobile = FullMobile.join();
            var FinalBulkSMSData = {"To":CommaSeperatedMobile,"Message":$scope.Bulk.SMSContent};

                $http.post('SendBulkSMS',FinalBulkSMSData).success(function(response){

                    if(response)
                    {
                    $('#SendBulkSmsModal').modal('hide');
                    $('#SmsSuccess').show(1000).delay(2000).hide(1000);;
                    $('#SmsSuccessMessage').html(response.message);
                    }
                    else
                    {
                    $('#SmsError').show(1000).delay(2000).hide(1000);;
                    $('#SmsErrorMessage').html("Not possible to execute now! Sorry for the inconvenience.");
                    }

                });
    }
    else {
      $('#SmsBulkError').show(1000).delay(2000).hide(1000);;
      $('#SmsBulkErrorMessage').html("Message should not be empty.");
    }
  }
  else {
    $('#SmsBulkError').show(1000).delay(2000).hide(1000);;
    $('#SmsBulkErrorMessage').html("Message should not be empty.");
  }

};





}]);
</script>



</body>
<div class="modal fade" id="SendSMSModal" role="dialog" style="display:none;top:20px;">
    <div class="modal-dialog" >

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Send SMS</h4>
        </div>
        <div class="modal-body">

          <form class="form-horizontal form-label-left" style="min-height: 200px;">

            <div class="alert alert-danger"  id="SmsIndividualError" style="display:none;text-align:center;">
            <strong id="SmsIndividualErrorMessage"></strong>
            </div>

            <ul class="tags">
              <li><a href="#" class="tag" style="text-decoration:none;">{{AllCustData.Mobile}}</a></li>

            </ul>

            <div class="form-group">
              <label class="control-label col-md-3" for="last-name">Compose SMS <span class="required">*</span>
              </label>
              <div class="col-md-8">
                <textarea  class="form-control col-md-6 col-xs-12" style="height:120px;" ng-model="Individual.SMSContent"></textarea>
              </div>
            </div>


          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal" style="float:left;">Close</button>
          <button type="button" class="btn btn-primary" style="float:right;" ng-click="SendIndividualSms()">SEND</button>
        </div>
      </div>

    </div>
  </div>


  <div class="modal fade" id="SendBulkSmsModal" role="dialog" style="display:none;top:20px;">
      <div class="modal-dialog" >

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Send SMS</h4>
          </div>
          <div class="modal-body">
            <form class="form-horizontal form-label-left" style="min-height: 200px;">

                <div class="alert alert-danger"  id="SmsBulkError" style="display:none;text-align:center;">
                <strong id="SmsBulkErrorMessage"></strong>
                </div>

              <div class="form-group">
              <ul class="tags" >
                <li ng-repeat="BulkData in mySelectedRows">
                  <a href="#" class="tag" style="text-decoration:none;">{{BulkData.Mobile}}</a>
                </li>
              </ul>
            </div>

              <div class="form-group">
                <label class="control-label col-md-3" for="last-name">Compose SMS <span class="required">*</span>
                </label>
                <div class="col-md-8">
                  <textarea  class="form-control col-md-6 col-xs-12" style="height:120px;" ng-model="Bulk.SMSContent"></textarea>
                </div>
              </div>


            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" style="float:left;">Close</button>
            <button type="button" class="btn btn-primary" style="float:right;" ng-click="SendBulkSms()">SEND</button>
          </div>
        </div>

      </div>
    </div>















</html>
